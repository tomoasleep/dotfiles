#!/usr/bin/env bash

set -euo pipefail

if [ $# -lt 2 ]; then
  echo "Usage: with-znotify <EMOJI> -- <command> [args...]" >&2
  echo "       with-znotify <EMOJI_OK> <EMOJI_NG> -- <command> [args...]" >&2
  exit 1
fi

if [ "$2" == "--" ]; then
  EMOJI_OK=$1
  EMOJI_NG=$1
  shift
else
  EMOJI_OK=$1
  EMOJI_NG=$2
  shift 2
fi

if [ "$1" != "--" ]; then
  echo "Error: Expected '--' after EMOJI_NG" >&2
  exit 1
fi
shift

COMMAND="$*"

if "$@"; then
  znotify "$EMOJI_OK"
  exit 0
else
  EXIT_CODE=$?
  znotify "$EMOJI_NG"
  exit $EXIT_CODE
fi

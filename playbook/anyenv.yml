- hosts: localhost
  connection: local
  gather_facts: no
  tasks:
    - git:
        repo: https://github.com/riywo/anyenv
        dest: ~/.anyenv
        update: yes

    - name: Install envs
      shell: '(~/.anyenv/bin/anyenv version | grep {{ item }}) || ~/.anyenv/bin/anyenv install {{ item }}'
      with_items:
        - rbenv
        - nodenv
        - pyenv
        - goenv
        
    - git:
        repo: https://github.com/nodenv/nodenv-package-rehash
        dest: ~/.anyenv/envs/nodenv/plugins/nodenv-package-rehash
        update: yes

    - name: Install rehash hooks for nodenv
      shell: '~/.anyenv/envs/nodenv/bin/nodenv package-hooks install'

    - git:
        repo: https://github.com/pyenv/pyenv-virtualenv
        dest: ~/.anyenv/envs/pyenv/plugins/pyenv-virtualenv
        update: yes

    - name: Check if nvim-python3 virtualenv is exists
      shell: pyenv virtualenvs | grep nvim-python3
      register: nvimCheckResult
      changed_when: False
      ignore_errors: True

    - command: pyenv virtualenv 3.7.3 nvim-python3
      when: nvimCheckResult is failed

